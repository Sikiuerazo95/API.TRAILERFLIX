# API.TRAILERFLIX üé¨üçøüì∫

__API.TRAILERFLIX__ esta dise√±ada para gestionar catalogos de series y peliculas. Esta Api permite realizar busquedas a traves de distintos endpoints, lo que no solo hace posible **buscar** sino tambien **crear**, **modificar** y **eliminar** registros de forma sencilla, todo con el respaldo de **MySQL** como base de datos.

---

## üìö Librer√≠as utilizadas

üü¢ Node.js
üöÇ Express
üê¨ MySQL
üì¶ Body-parser
üîê Dotenv
üìÅ Sequelize

---

## ‚öôÔ∏è Configuracion de entorno

Se creo un archivo **.env** en la raiz del proyecto, para garantizar que la aplicacion funcione correctamente y proteja la informacion sensible.

* PORT
* DB_HOST
* DB_USER
* DB_PASS
* DB_NAME

---

## üê¨ Base de datos **Mysql**

En la base de datos **trailerflix** se almacena informacion sobre **series y peliculas**. Esta informacion se organiza en diferentes tablas que se encuentran relacionadas entre si, y la estructura esta dise√±ada para ser utilizada en una **API RESTful** que permite **buscar**, **crear**, **modificar** y **eliminar** registros. Ademas se crea una **tabla view** que unifica los datos mas relevantes de cada contenido, facilitando las consultas completas desde un unico punto, esta tabla se implementa como una vista SQL construida a partir de varias tablas relacionadas mediante JOIN.

### categorias

| Campo             | Tipo           | Descripcion                  |
|-------------------|----------------|------------------------------|
| idCategoria       | INT (PK)       | ID unico                     |
| nombreCategoria   | VARCHAR(50)    | Serie o pelicula             |

### generos

| Campo          | Tipo           | Descripcion                  |
|----------------|----------------|------------------------------|
| idGenero       | INT (PK)       | ID unico                     |
| nombreGenero   | VARCHAR(50)    | Terror, comedia, etc..       |

### contenido

| Campo          | Tipo           | Descripcion                              |
|----------------|----------------|------------------------------------------|
| idContenido    | INT (PK)       | ID unico                                 |
| titulo         | VARCHAR(100)   | Titulo de la serie o pelicila pelicula   |
| resumen        | TEXT           | Sinopsis                                 |
| temporadas     | INT            | Numero de temporadas si existen          |
| poster         | VARCHAR(200)   | URL del afiche o portada                 |
| trailer        | VARCHAR(200)   | URL del trailer                          |
| idCategoria    | INT (FK)       | Relaci√≥n con la tabla `categorias`       |
| idGenero       | INT (FK)       | Relaci√≥n con la tabla `generos`          |

### tags

| Campo       | Tipo           | Descripcion              |
|-------------|----------------|--------------------------|
| idTag       | INT (PK)       | ID unico                 |
| nombreTag   | VARCHAR(50)    | Accion, drama, etc..     |

### contenido_tags

| Campo          | Tipo           | Descripcion                         |
|----------------|----------------|-------------------------------------|
| idContenido    | INT (FK)       | Relaci√≥n con la tabla `contenido`   |
| idTag          | INT (FK)       | Relaci√≥n con la tabla `tags`        |

### actores

| Campo         | Tipo           | Descripcion                  |
|---------------|----------------|------------------------------|
| idActor       | INT (PK)       | ID unico                     |
| nombreActor   | VARCHAR(100)   | Nombre del actor o actriz    |

### reparto

| Campo          | Tipo           | Descripcion                         |
|----------------|----------------|-------------------------------------|
| idContenido    | INT (FK)       | Relaci√≥n con la tabla `contenido`   |
| idActor        | INT (FK)       | Relaci√≥n con la tabla `actores`     |

### contenido_completo (tabla view)

| Campo          | Tipo           | Descripcion                                       |
|----------------|----------------|---------------------------------------------------|
| idContenido    | INT (PK)       | ID unico                                          |
| titulo         | VARCHAR(100)   | Titulo de la serie o pelicila pelicula            |
| resumen        | TEXT           | Sinopsis                                          |
| temporadas     | INT            | Numero de temporadas si existen                   |
| poster         | VARCHAR(200)   | URL del afiche o portada                          |
| trailer        | VARCHAR(200)   | URL del trailer                                   |
| categoria      | VARCHAR(50)    | Nombre de la categoria                            |
| genero         | VARCHAR(50)    | Nombre del genero                                 |
| tags           | TEXT           | Lista de etiquetas asociadas separadas por comas  |
| reparto        | TEXT           | Lista de actores vinculados separados por comas   |


A continuacion se muestra un diagrama entidad-relacion que representa visualmente la estructura y las relaciones:

![Diagrama de la base de datos TrailerFlix](./asset/relacion%20de%20tablas.jpg)

---

## üîå Conexion a la base de datos

El archivo **app.js** se conecta a la base de datos **Mysql** utlizando un archivo externo llamado **database.js**, que contiene la configuracion y logica de conexion.

* sequelize
* authenticate()
* closeConnection()
  
---

## üóÇÔ∏è Estructura general del proyecto

Este proyecto esta organizado en varias carpetas y archivos claves que nos ayudan en la organizacion del codigo y en la escalabilidad de la API.

### `app.js`

Es el archivo principal que configura y levanta el servidor **Express**, configura middlewares globales, como el manejo de JSON con **express.json()**, importa y registra las rutas de la API, define el puerto por el cual se va a escucha el servidor e inicia el servidor.

### Carpeta `models`

La carpeta models contiene los modelos de datos que definen la estructura de las tablas utilizadas en la base de datos de la **API.TRAILERFLIX**, asi como sus relaciones y configuraciones, todos los modelos usan sequelize para definir los tipos de datos y configurar las claves primarias, foraneas y restricciones.

El archivo **registro.js** es el nucleo central de los modelos en la **API.TRAILERFLIX** ya que se encarga de **definir las relaciones** entre las distintas tablas, **importar y registrar** todos los modelos, **configurar y exportar** para poder utilizarlo en diferentes partes de la aplicacion 

```javascript 
const {sequelize} = require('../database');

const Contenido = require('./contenido');
const Actor = require('./actores');
const Reparto = require('./reparto');
const Tag = require('./tags');
const ContenidoTag = require('./contenido_tags');
const ContenidoCompleto = require("./contenido_completo");
const Categoria = require('./categorias');
const Genero = require('./generos');


Contenido.belongsToMany(Tag, {
  through: ContenidoTag,
  foreignKey: 'idContenido',
  otherKey: 'idTag'
});
Tag.belongsToMany(Contenido, {
  through: ContenidoTag,
  foreignKey: 'idTag',
  otherKey: 'idContenido'
});

Contenido.belongsToMany(Actor, {
  through: Reparto,
  foreignKey: 'idContenido',
  otherKey: 'idActor'
});
Actor.belongsToMany(Contenido, {
  through: Reparto,
  foreignKey: 'idActor',
  otherKey: 'idContenido'
});


Contenido.belongsTo(Categoria, {
  foreignKey: 'idCategoria'
});
Categoria.hasMany(Contenido, {
  foreignKey: 'idCategoria'
});

Contenido.belongsTo(Genero, {
  foreignKey: 'idGenero'
});
Genero.hasMany(Contenido, {
  foreignKey: 'idGenero'
});


module.exports = {
  sequelize,
  ContenidoCompleto,
  Contenido,
  Actor,
  Reparto,
  Tag,
  ContenidoTag,
  Categoria,
  Genero
};
```

### Carpeta `routes`

Esta carpeta contiene los archivos que definen las rutas de nuestra **API.TRAILERFLIX**. Cada archivo suele corresponder a un conjunto de funcionalidades y dentro se configuraron las rutas HTTP (GET, POST, PUT, DELETE) para manejar las solicitudes relacionadas.

El archivo **index.js** se encarga de **centralizar y organizar** todos los endpoints de la API.TRAILERFLIX. 

| M√©todo | Ruta                     | Descripci√≥n                              | 
| ------ | ------------------------ | ---------------------------------------- |
| GET    | `/catalogo`              | Obtiene todo el contenido del cat√°logo   |
| GET    | `/catalogo/:id`          | Obtiene un contenido por su ID           | 
| GET    | `/categorias/:categoria` | Filtra contenido por categor√≠a           | 
| GET    | `/generos/:genero`       | Filtra contenido por g√©nero              | 
| GET    | `/completo`              | Obtiene el contenido con datos completos | 
| POST   | `/catalogo`              | Crea un nuevo contenido                  |  
| PUT    | `/catalogo/:id`          | Actualiza un contenido existente         | 
| DELETE | `/catalogo/:id`          | Elimina un contenido por su ID           |                                                                           |

### Endpoints disponibles

#### üìç GET /catalogo
__Descripci√≥n:__ Trae la vista completa de toda la base de datos.

---

## üßæ Descripci√≥n

Este endpoint:

- Consulta la vista `contenido_completo`
- Devuelve un array de objetos JSON
- Convierte los campos `tags` y `reparto` de formato string separado por comas a arrays

---

## üîÑ Ejemplo de respuesta (`200 OK`)

```json
[
  {
    "idContenido": 1,
    "titulo": "The Crown",
    "resumen": "Este drama narra las rivalidades pol√≠ticas...",
    "temporadas": 4,
    "poster": "./posters/1.jpg",
    "trailer": "https://www.youtube.com/embed/JWtnJjn6ng0",
    "nombreCategoria": "Serie",
    "nombreGenero": "Suceso Real",
    "tags": ["Drama", "Suceso Real"],
    "reparto": ["Claire Foy", "Matt Smith"]
  },
  {
    "idContenido": 2,
    "titulo": "Inception",
    "resumen": "Un ladr√≥n roba secretos del subconsciente...",
    ...
  }
]

```

## ‚ùå Posibles errores

| C√≥digo | Descripci√≥n                           |
| ------ | ------------------------------------- |
| 500    | Error al consultar contenido completo |

## üì¶ Modelos involucrados

const { ContenidoCompleto } = require('../../models/registro');

## üîÆ Pruebas con Postman

1. Seleccionar m√©todo: GET

2. URL: http://localhost:3000/endpoints/completo

3. No se requiere body ni headers especiales

4. Click en Send para recibir la lista de contenido

* NOTA: Asegurase de que la vista contenido_completo est√© correctamente creada en tu base de datos MySQL. El backend transforma internamente los strings de tags y reparto en arrays antes de devolverlos.

---

#### üìç GET /completo

üìñ **Descripci√≥n:** Devuelve el cat√°logo completo de t√≠tulos en TrailerFlix.

‚úÖ **Respuesta exitosa (200):** Array de objetos con los t√≠tulos disponibles, sus categor√≠as y g√©neros.

‚ùå **Error (500):**

```json
{ "error": "Hubo un error en el servidor" }
```

**Archivo asociado:** `getAll.js`

---

#### üìç GET /catalogo/:id 

üìñ **Descripci√≥n:** Devuelve la informaci√≥n de un t√≠tulo espec√≠fico seg√∫n su `idContenido`.

üì• **Par√°metros de ruta:**

* `id`: n√∫mero de ID del contenido a buscar.

‚úÖ **Respuesta exitosa (200):** Objeto con la informaci√≥n del t√≠tulo encontrado.

‚ùå **Error (404):**

```json
{ "error": "No encontrado" }
```

‚ùå **Error (500):**

```json
{ "error": "Hubo un error en el servidor" }
```

**Archivo asociado:** `getByID.js`

---

#### üìç GET /categorias/:categoria 

üìñ **Descripci√≥n:** Devuelve los t√≠tulos filtrados por la categor√≠a proporcionada.

üì• **Par√°metros de ruta:**

* `categoria`: nombre de la categor√≠a a buscar.

‚úÖ **Respuesta exitosa (200):** Array de objetos con los t√≠tulos encontrados.

‚ùå **Error (400):**

```json
{ "error": "Falta el par√°metro de categor√≠a" }
```

‚ùå **Error (500):**

```json
{ "error": "Hubo un error en el servidor" }
```

**Archivo asociado:** `getByCategorias.js`

---

### üìç GET /generos/:genero

üìñ **Descripci√≥n:** Devuelve los t√≠tulos filtrados por el g√©nero proporcionado.

üì• **Par√°metros de ruta:**

* `genero`: nombre del g√©nero a buscar.

‚úÖ **Respuesta exitosa (200):** Array de objetos con los t√≠tulos encontrados.

‚ùå **Error (400):**

```json
{ "error": "Falta el par√°metro de g√©nero" }
```

‚ùå **Error (500):**

```json
{ "error": "Hubo un error en el servidor" }
```

**Archivo asociado:** `getByGeneros.js`



#### üìç POST /catalogo
---

## üõãÔ∏è JSON esperado (Body)

```json
{
  "titulo": "The Crown",
  "resumen": "Este drama narra las rivalidades pol√≠ticas y romances durante el reinado de Isabel II.",
  "temporadas": 4,
  "poster": "./posters/1.jpg",
  "trailer": "https://www.youtube.com/embed/JWtnJjn6ng0",
  "categoria": "Serie",
  "genero": "Suceso Real",
  "tags": "Drama,Suceso Real",
  "reparto": "Claire Foy, Helena Bonham Carter, Matt Smith"
}
```

> ‚ö†Ô∏è Los campos `tags` y `reparto` deben enviarse como **strings separados por comas**.

---

## ‚úÖ Funcionamiento del endpoint

1. Busca el **ID** correspondiente al nombre de la categor√≠a enviada.
2. Busca el **ID** correspondiente al nombre del g√©nero enviado.
3. Crea un nuevo registro en la tabla `contenido`.
4. Procesa los `tags`:

   * Si existen, los vincula.
   * Si no existen, los crea y luego los vincula (tabla `contenido_tags`).
5. Procesa el `reparto`:

   * Si los actores ya existen, los vincula.
   * Si no existen, los crea y luego los vincula (tabla `reparto`).

---

## üîπ Respuesta exitosa (`201 Created`)

```json
{
  "message": "Contenido creado correctamente",
  "contenido": {
    "idContenido": 5,
    "titulo": "The Crown",
    "resumen": "...",
    "temporadas": 4,
    "poster": "./posters/1.jpg",
    "trailer": "https://www.youtube.com/embed/JWtnJjn6ng0",
    "idCategoria": 2,
    "idGenero": 3
  }
}
```

---

## ‚ùå Posibles errores

| C√≥digo | Descripci√≥n                  |
| ------ | ---------------------------- |
| 400    | Faltan campos obligatorios   |
| 400    | Categor√≠a no encontrada      |
| 400    | G√©nero no encontrado         |
| 500    | Error interno en el servidor |

---

## üîÆ Pruebas con Postman

1. Seleccionar el m√©todo `POST` y URL: `http://localhost:3000/endpoints`
2. Ir a la pesta√±a **Body** > seleccionar **raw** > tipo **JSON**
3. Pegar el cuerpo de ejemplo en el editor
4. Click en **Send**

---

## üîß Campos requeridos

Este endpoint utiliza los siguientes modelos:

* `Contenido`
* `Categoria`
* `Genero`
* `Tag`
* `ContenidoTag`
* `Actor`
* `Reparto`

* NOTA: Hay que asegurarse de que todas las tablas existen y est√°n correctamente relacionadas en la base de datos.

---


#### üìç PUT /catalogo/:id

__Descripci√≥n:__ Este endpoint permite **modificar** los datos de un contenido previamente creado. Puede actualizar cualquier campo enviado en el cuerpo de la petici√≥n.

* NOTA: No se puede modificar el campo `_id`.


## üí° Endpoint

```
PUT /catalogo/:id
```

---

## üõãÔ∏è JSON esperado (Body)

Se puede enviar cualquiera de los siguientes campos para actualizar:

```json
{
  "titulo": "Nuevo t√≠tulo opcional",
  "resumen": "Nuevo resumen opcional",
  "temporadas": 5,
  "poster": "./posters/nuevo.jpg",
  "trailer": "https://www.youtube.com/embed/nuevo"
}
```

> ‚ö†Ô∏è Este endpoint **no modifica** los tags ni el reparto. Solo afecta la tabla `contenido` directamente.

---

## ‚úÖ Funcionamiento del endpoint

1. Busca el contenido por ID (`req.params.id`).
2. Si no existe, devuelve error 404.
3. Si existe, actualiza los campos enviados mediante `req.body`.
4. Devuelve el contenido actualizado como respuesta.

---

## üîπ Respuesta exitosa (`200 OK`)

```json
{
  "idContenido": 5,
  "titulo": "Nuevo t√≠tulo opcional",
  "resumen": "Nuevo resumen opcional",
  "temporadas": 5,
  "poster": "./posters/nuevo.jpg",
  "trailer": "https://www.youtube.com/embed/nuevo",
  "idCategoria": 2,
  "idGenero": 3
}
```

---

## ‚ùå Posibles errores

| C√≥digo | Descripci√≥n                   |
| ------ | ----------------------------- |
| 404    | T√≠tulo no encontrado          |
| 500    | Error al actualizar contenido |

---

## üîÆ Pruebas con Postman

1. Seleccionar el m√©todo `PUT` y la URL: `http://localhost:3000/catalogo/5`
2. Ir a la pesta√±a **Body** > seleccionar **raw** > tipo **JSON**
3. Enviar los campos que se deseen modificar
4. Click en **Send**

---

## üîß Dependencias requeridas

Este endpoint utiliza el siguiente modelo:

* `Contenido`

---


#### üìç DELETE /catalogo/:id

__Descripci√≥n:__ Este endpoint elimina un ID y todos sus datos de la base de datos.

---

## üóÇÔ∏è Endpoint

```
DELETE /catalogo/:id
```

---

## üîÑ Funcionamiento

1. Recibe el par√°metro `id` para identificar el contenido.
2. Verifica que el contenido exista en la base de datos (`Contenido.findByPk`).
3. Elimina las entradas asociadas:
   * `contenido_tags`
   * `reparto`
4. Luego elimina el contenido en s√≠.

---

## ‚úÖ Respuesta exitosa

```json
{
  "message": "Titulo eliminado correctamente"
}
```

---

## ‚ùå Posibles errores

| C√≥digo | Descripci√≥n                 |
| ------ | --------------------------- |
| 404    | T√≠tulo no encontrado        |
| 500    | Error al eliminar el t√≠tulo |

---

## üì¶ Modelos involucrados

* `Contenido`
* `ContenidoTag`
* `Reparto`

---
